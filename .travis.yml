language: generic
os: linux
dist: bionic
services: [mysql, postgresql]
branches: {except: [gh-pages]}
git: {depth: 1}
addons:
  apt:
      update: true
      packages:
          - elixir
          - erlang
          - fpc
          - gawk
          - lua5.3
          - mono-devel
          - nim
          - r-base
          - rakudo
          - rustc
          - sqlite3
          - zsh
  snaps:
      - name: julia
        confinement: classic
      - name: kotlin
        confinement: classic
env:
    global:
        - PERL5LIB="$HOME/.local/share/perl5/lib/perl5"
        - PATH="$PATH:/usr/lib/dart/bin:$TRAVIS_BUILD_DIR/node_modules/.bin"
before_install:
    - |
        wget -q https://downloads.lightbend.com/scala/2.13.6/scala-2.13.6.deb
        sudo -E dpkg -i "${_##*/}"
    - |
        wget -q http://downloads.dlang.org/releases/2021/dmd_2.098.0-0_amd64.deb
        sudo -E dpkg -i "${_##*/}"
    - |
        wget -q https://storage.googleapis.com/dart-archive/channels/stable/release/2.14.4/linux_packages/dart_2.14.4-1_amd64.deb
        sudo -E dpkg -i "${_##*/}"
    - nvm use 12 && yarn add @types/node coffeescript livescript ts-node typescript
install:
    - cpanm -qnl ~/.local/share/perl5 JSON::Parse
before_script:
    - |
        psql -c 'DROP DATABASE IF EXISTS "7SegmentDisplays";'
        psql -c 'CREATE DATABASE "7SegmentDisplays";'
    - |
        mysql -e 'CREATE DATABASE IF NOT EXISTS 7SegmentDisplays;'
        mysql -e 'SET GLOBAL local_infile = 1;'
script:
    - make all test
before_deploy:
    - |
        wget https://github.com/sharkdp/hyperfine/releases/download/v1.11.0/hyperfine_1.11.0_amd64.deb
        sudo -E dpkg -i "${_##*/}"
    - make bench
deploy:
    provider: pages
    strategy: git
    cleanup: false
    keep_history: false
    email: deploy@travis-ci.org
    name: Deployment Bot
    commit_message: Deploy %{target_branch}
    github_token: $GH_TOKEN
    on: {branch: master}
